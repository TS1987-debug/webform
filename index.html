<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chatbot with Webhook</title>
  <style>
    :root{--bg:#f7fafc;--card:#ffffff;--accent:#7c3aed;--user:#e0f2fe;--bot:#eef2ff}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#f0f4f8, #ffffff);font-family:Arial,sans-serif;color:#0f172a}
    .chat-wrap{width:100%;max-width:420px;background:var(--card);border-radius:16px;box-shadow:0 6px 20px rgba(2,6,23,0.08);overflow:hidden}
    header{padding:16px 18px;border-bottom:1px solid #eef2ff;display:flex;gap:12px;align-items:center;background:linear-gradient(90deg,rgba(124,58,237,0.08),transparent)}
    .dot{width:42px;height:42px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    header h1{font-size:16px;margin:0}
    header p{margin:0;font-size:12px;color:#475569}

    .messages{height:440px;padding:18px;overflow:auto;display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg,transparent,rgba(10,10,10,0.01))}
    .bubble{max-width:78%;padding:10px 12px;border-radius:12px;line-height:1.35;box-shadow:0 1px 0 rgba(0,0,0,0.02)}
    .bot{align-self:flex-start;background:var(--bot);border-bottom-left-radius:4px}
    .user{align-self:flex-end;background:var(--user);border-bottom-right-radius:4px}
    .meta{font-size:11px;color:#64748b;margin-top:6px}

    .composer{display:flex;padding:12px;border-top:1px solid #f1f5f9;gap:8px}
    .composer input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #e6eef8;background:#fbfdff;outline:none;font-size:14px}
    .composer button{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .composer button:active{transform:translateY(1px)}

    .typing{display:inline-block;height:10px;width:34px}
    .dot-typing{display:inline-block;width:6px;height:6px;margin-right:4px;border-radius:50%;background:#94a3b8;opacity:0;animation:typing 1s infinite}
    .dot-typing:nth-child(1){animation-delay:0s}
    .dot-typing:nth-child(2){animation-delay:0.15s}
    .dot-typing:nth-child(3){animation-delay:0.3s}
    @keyframes typing{0%{opacity:0;transform:translateY(0)}50%{opacity:1;transform:translateY(-4px)}100%{opacity:0;transform:translateY(0)}}

    @media (max-width:420px){.messages{height:360px}}
  </style>
</head>
<body>
  <main class="chat-wrap" role="application" aria-label="Chatbot with Webhook">
    <header>
      <div class="dot">CB</div>
      <div>
        <h1>Webhook Chatbot</h1>
        <p>Chat powered via webhook</p>
      </div>
    </header>

    <section class="messages" id="messages" aria-live="polite"></section>

    <form class="composer" id="composer" autocomplete="off">
      <input id="input" name="message" placeholder="Type a message..." aria-label="Message input" />
      <button type="submit">Send</button>
    </form>
  </main>

  <script>
    const messagesEl = document.getElementById('messages');
    const form = document.getElementById('composer');
    const input = document.getElementById('input');

    function appendBubble(text, who = 'bot') {
      const wrap = document.createElement('div');
      wrap.className = 'bubble ' + (who === 'user' ? 'user' : 'bot');
      wrap.innerHTML = `<div>${escapeHtml(text)}</div>`;
      messagesEl.appendChild(wrap);
      messagesEl.scrollTop = messagesEl.scrollHeight - messagesEl.clientHeight + 100;
      return wrap;
    }

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    async function botReplyFor(userText) {
      try {
        const response = await fetch("https://hooks.zapier.com/hooks/catch/24917788/u537s8d/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ message: userText })
        });

        if (!response.ok) throw new Error("Webhook error: " + response.status);

        const data = await response.json();
        // Expect the webhook to return { "reply": "some text" }
        return data.reply || "Sorry, no reply received.";
      } catch (error) {
        console.error("Error calling webhook:", error);
        return "Oops â€” something went wrong. Try again later.";
      }
    }

    function showTyping() {
      const t = document.createElement('div');
      t.className = 'bubble bot';
      t.id = 'typing';
      t.innerHTML = `<div class="typing" aria-hidden="true"><span class="dot-typing"></span><span class="dot-typing"></span><span class="dot-typing"></span></div>`;
      messagesEl.appendChild(t);
      messagesEl.scrollTop = messagesEl.scrollHeight;
      return t;
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const value = input.value;
      if (!value.trim()) return;

      appendBubble(value, 'user');
      input.value = '';
      input.focus();

      const typingEl = showTyping();
      botReplyFor(value).then(reply => {
        typingEl.remove();
        appendBubble(reply, 'bot');
      });
    });

    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => appendBubble("Hello! Ask me anything.", 'bot'), 300);
    });
  </script>
</body>
</html>
